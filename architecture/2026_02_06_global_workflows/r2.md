Summary
=======
Global workflows are published templates that appear for all users but are
not executed directly. When a user starts a run from a global workflow, the
system creates or updates a hidden per-user copy and runs against that copy.
This preserves existing per-user scoping for workflow data while keeping a
single global source of truth for published templates.

Design Decisions
================
- Global templates are stored as separate templates with scope=global and
  visibility=public. They are read-only for non-admin users.
- User execution always uses a hidden per-user template derived from the
  global template. This keeps workflow_template_id scoped per user.
- Hidden template naming is deterministic: global_{global_id}_{user_id}.
- Hidden templates are excluded from normal template listings.
- Version sync only happens when a user starts from a global template. No
  automatic background patching is performed.
- Resume-time patching and user forking are explicitly out of scope for this
  revision.
- Global templates can be mutated by admins; they are not immutable.

Technical Specification
=======================
Template creation and sync
--------------------------
1. User selects a global template to start a run.
2. Server resolves or creates a hidden per-user template:
   - name: global_{global_id}_{user_id}
   - scope=user
   - visibility=hidden
   - derived_from=global_template_id
3. Server copies any missing global versions into the hidden template.
   Missing versions are identified by content_hash comparison. The copy
   preserves resolved_workflow, source_type, version_type, and created_at.
4. The run is started using the selected version in the hidden template.

Template listing
----------------
- Normal listing returns:
  - user templates with visibility=public
  - global templates with visibility=public
- Hidden templates are excluded by default.
- UI sorts global templates to the top and adds a "Global" badge.

Admin publishing
---------------
- Admin selects a personal template version to publish.
- Server creates or updates a global template and stores the version as a
  global version document.
- Global templates do not auto-update any user templates.

Scope boundaries
----------------
- Workflow execution, db.query, and weighted_keywords remain scoped by the
  per-user workflow_template_id of the hidden template.
- Global templates are never used directly for execution.

Database Schema
===============
workflow_templates
------------------
New fields:
- scope: "global" | "user"
- visibility: "public" | "hidden"
- derived_from: <global_template_id> (only for hidden per-user templates)

API Contracts
=============
GET /workflow-templates
-----------------------
Returns public user templates plus public global templates. Hidden templates
are excluded. Response includes scope and visibility flags.

POST /workflow-templates/global/publish
---------------------------------------
Admin-only. Publishes a selected user version to a global template. If the
global template does not exist, it is created.

POST /workflow/start/{version_id}
---------------------------------
Enforces ownership: the version must belong to the current user or to a
global template. If the version is global, the server must create or update
the hidden per-user template and start from the corresponding copied
version.

Questions for Review
====================
1. Version sync includes all versions from the global template. No versions
   are omitted.
2. Global templates are mutable by admins.
