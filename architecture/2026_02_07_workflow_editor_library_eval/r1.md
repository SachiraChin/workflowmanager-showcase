# Workflow Editor Library Evaluation (r1)

## Summary

This document evaluates node/diagram libraries for the new `ui/editor`
workspace and recommends a primary choice before implementation starts.

The key risk to de-risk first is deep nested modules/subflows. This was a
real pain point in prior React Flow attempts, so nesting behavior has the
highest weight in this evaluation.

This document treats current code as source of truth. The previous
`architecture/2026_02_04_workflow_editor/r2.md` remains historical context,
but parts of it are outdated.

## Design Decisions

1. We evaluate libraries against the current stack and architecture:
   React 19, Vite, Tailwind v4, shared-first reuse via `@wfm/shared`, and
   class-based theme variables used by webui.
2. We do not require any webui cleanup before editor work.
3. Recommendation includes a fallback if nested behavior does not meet
   requirements in a focused PoC.
4. Every major claim is labeled as:
   - **Verified**: direct docs/source text observed.
   - **Inferred**: likely based on examples/ecosystem patterns.
   - **Unknown**: needs validation in our PoC.

## Technical Specification

### Current Architecture Constraints (Verified)

- `ui/package.json` currently lists only `shared` and `webui` workspaces.
- `ui/shared/src/index.ts` exports a large shared surface (types, state,
  renderers, UI components, interactions), so editor should reuse this
  package rather than duplicate logic.
- `ui/webui/src/index.css` and theme provider use Tailwind v4 + CSS
  variables + `light/dark` class switching, which editor should match.

### Evaluation Criteria and Weights

| Criterion | Weight | Why it matters |
|---|---:|---|
| Nested/group/subflow model | 25 | Most critical risk and hardest to swap later |
| Integration with stack/shared/theme | 25 | Must fit React 19 + Vite + Tailwind + `@wfm/shared` |
| Edge/port flexibility | 15 | Workflow modules need explicit IO semantics |
| Interaction quality/extensibility | 10 | DnD, selection, keyboard, undo/redo potential |
| Performance at scale | 10 | Real workflows may grow significantly |
| SSR/build/tooling risk | 5 | Keep Vite/tooling friction low |
| License/commercial constraints | 10 | Avoid surprises for product and legal |

Scoring uses 1-5 per criterion, then weighted to a 100-point total.

### Candidate Analysis

#### React Flow (`@xyflow/react`)

- Nested/subflow: **Verified** `parentId`-based subflows, explicit notes on
  parent-child ordering and behavior limits.
- Edge/ports: **Verified** custom handles/edges and many edge APIs/examples.
- Performance: **Verified** dedicated performance guidance (memoization,
  state access patterns, collapsing trees).
- Integration: **Verified** React-native fit, docs updated for React 19 and
  Tailwind v4 components.
- SSR/build: **Verified** SSR supported since v12 with explicit width/height
  and handle data requirements.
- License: **Verified** MIT core, optional commercial Pro offering.
- Risk note: deep recursive nesting UX and constraints are still partly
  **Unknown** until we run our own nested stress PoC.

#### GoJS

- Nested/group: **Verified** first-class groups, nested groups, subgraphs,
  collapsing/expanding behavior.
- Edge/ports: **Verified** rich link and port model.
- Performance: **Inferred** strong diagram-engine maturity and long history.
- Integration: **Verified** React integration docs exist; **Inferred** higher
  integration overhead vs React-native libs.
- License: **Verified** commercial EULA and per-license restrictions.
- Risk note: legal/procurement friction is likely for early iteration.

#### Rete

- Nested/group: **Verified** scopes/modules plugins and modular node-editor
  architecture.
- Edge/ports: **Verified** plugin-based connection system with presets.
- Performance: **Inferred** good extensibility, but scale behavior depends on
  plugin/render choices.
- Integration: **Verified** React renderer plugin and framework integration.
- License: **Verified** core MIT, but some advanced plugins are
  CC-BY-NC-SA-4.0 (non-commercial).
- Risk note: licensing split can block commercial use of specific advanced
  features; nested features may require those plugins (**Unknown** for our
  exact use case).

#### Cytoscape.js

- Nested/group: **Verified** compound graph support and compound demos.
- Edge/ports: **Inferred** less workflow-editor-centric port semantics than
  dedicated node editors.
- Performance: **Verified** strong optimization claims and large ecosystem.
- Integration: **Inferred** heavier adaptation needed to deliver UX expected
  from modern workflow editors.
- License: **Verified** MIT core.
- Risk note: great graph engine, but higher product-layer build effort.

#### JointJS (OSS core)

- Nested/group: **Verified** hierarchical diagrams, containers, embedding,
  parent-child APIs.
- Edge/ports: **Verified** rich connectors, routers, anchors, ports.
- Performance: **Inferred** mature engine and production usage.
- Integration: **Inferred** moderate effort in React apps (not React-native
  by design).
- License: **Verified** OSS core under MPL-2.0; commercial tier exists for
  extended productization.
- Risk note: license and architecture model need legal/engineering review.

#### yFiles for HTML

- Nested/group: **Inferred** broad support from feature set and demos;
  detailed API needs trial validation.
- Edge/ports/performance: **Inferred** very strong from product positioning,
  demos, and market reputation.
- Integration: **Inferred** feasible in web stack; deeper React ergonomics
  need trial verification.
- License: **Verified** commercial license model, perpetual and royalty-free,
  but paid.
- Risk note: technically very strong, but commercial dependency and pricing
  commitment should be explicit.

#### X6

- Nested/group: **Verified** group and graph editing features in docs/README.
- Edge/ports/interactions: **Verified** strong built-in extension set,
  keyboard/history/minimap/snapline, rich customization.
- Performance: **Inferred** good, plus stated SSR support in README.
- Integration: **Inferred** feasible with React, but documentation quality
  and language consistency vary by page.
- License: **Verified** MIT.
- Risk note: documentation fragmentation and ecosystem fit for our team
  should be validated before commitment.

### Practical Live Example Links

| Library | Practical examples |
|---|---|
| React Flow | https://reactflow.dev/examples/grouping/sub-flows ; https://reactflow.dev/examples/layout/elkjs |
| GoJS | https://gojs.net/latest/samples/regrouping.html ; https://gojs.net/latest/samples/orgChartEditor.html |
| Rete | https://retejs.org/examples ; https://studio.retejs.org |
| Cytoscape.js | https://js.cytoscape.org/#demos ; https://js.cytoscape.org/demos/compound-nodes/ |
| JointJS | https://www.jointjs.com/demos ; https://docs.jointjs.com/learn/features/containers-and-grouping/ |
| yFiles | https://www.yfiles.com/demos ; https://www.yfiles.com/demos/showcase/bpmn/ |
| X6 | https://x6.antv.antgroup.com/examples ; https://x6.antv.antgroup.com/tutorial/basic/group |

### Weighted Decision Matrix

| Library | Nested 25 | Integration 25 | Edge/Port 15 | Interaction 10 | Perf 10 | SSR/Build 5 | License 10 | Total (/100) |
|---|---:|---:|---:|---:|---:|---:|---:|---:|
| React Flow | 4 | 5 | 4 | 4 | 3 | 4 | 5 | 85 |
| yFiles | 5 | 3 | 5 | 5 | 5 | 4 | 2 | 83 |
| X6 | 4 | 3 | 4 | 4 | 4 | 3 | 5 | 76 |
| GoJS | 5 | 2 | 5 | 5 | 5 | 3 | 1 | 75 |
| JointJS | 4 | 3 | 4 | 4 | 4 | 3 | 3 | 72 |
| Rete | 4 | 3 | 4 | 5 | 3 | 3 | 3 | 72 |
| Cytoscape.js | 3 | 2 | 2 | 2 | 5 | 3 | 5 | 58 |

### Recommendation

Recommend **React Flow** as primary for `ui/editor`, with a strict nested
module de-risk PoC as the first implementation milestone.

Rationale:

- Best fit with existing React stack and shared-first architecture.
- Lowest integration friction with `@wfm/shared` and current theme system.
- Open license and strong ecosystem reduce product and maintenance risk.
- Existing concern (deep nesting limits) is real; we address it explicitly via
  an early fail-fast PoC instead of assuming success.

Secondary fallback if nested PoC fails acceptance thresholds:

- **Fallback A (commercial-capable): yFiles** for strongest technical nested
  and layout capabilities, if licensing is accepted.
- **Fallback B (OSS-first): X6** if we need OSS but decide React Flow nesting
  behavior is not acceptable.

### Fallback and Mitigation Plan (Nested-Limit Scenario)

If React Flow fails nested-module acceptance, proceed in order:

1. Attempt hybrid model inside React Flow:
   - Keep deep structure in workflow data model.
   - Render only active depth on canvas (progressive disclosure).
   - Provide breadcrumb/context panel for ancestors.
2. If UX still fails, run bounded spike comparison:
   - yFiles spike (commercial option).
   - X6 spike (OSS option).
3. Switch renderer behind editor domain contracts only, preserving:
   - workflow schema and persistence shape,
   - `@wfm/shared` UI reuse,
   - editor command/state interfaces.

### PoC Plan (Nested Risk First)

Goal: prove or disprove React Flow suitability for deep nested modules.

PoC scope (must-pass):

1. Build a synthetic workflow with 6-8 nested levels, 200-400 nodes,
   mixed intra- and cross-level edges.
2. Validate interactions:
   - create/move/delete nodes at multiple depths,
   - collapse/expand group layers,
   - keyboard navigation and selection consistency,
   - undo/redo command integrity.
3. Validate performance:
   - viewport pan/zoom smoothness,
   - interaction latency under edits,
   - re-render behavior under state updates.
4. Validate integration:
   - shared component usage from `@wfm/shared`,
   - theme parity with webui variable model,
   - Vite build stability.

Acceptance thresholds (initial):

- No data corruption across nesting operations.
- No blocking UI stalls in common editing interactions.
- Predictable navigation model for deep hierarchies.
- No architectural blockers for shared-first reuse.

## Database Schema

No database schema changes are proposed in this evaluation phase.

## API Contracts

No API contract changes are required in this evaluation phase.

## Questions for Review

1. Do we approve React Flow as primary with a fail-fast nested PoC gate
   before broader editor implementation?

   <!--i am not 100% undecided if i want to use React Flow. I think as you
   said, we need to create POC for each. we will create 2 types of POCs for
   each lib, one for performance measuring poc which you discussed above. but
   apart from that, we will also create POC purely based on
   workflows/cc/steps/1_user_input step of the workflow. we will not make any
   changes to files in this folder, each poc we create render 2 modules in this
   step best possible way. we will start poc with React Flow and then we will
   go from there. Feel free to create ediot folder, but we will create new page
   for each poc we make, page can be exposed via webui. feel free to ask me any
       questions about second poc.-->

2. If React Flow fails the nested gate, should fallback priority be
   yFiles-first (stronger engine, paid) or X6-first (OSS)?

    <!--my thinking is X6 -> JoinJS --> Rete based on how each looked in their
    examples. I am open to change order or pick others. -->

3. Are the proposed PoC acceptance thresholds sufficient, or should we add
   stricter numeric latency targets before implementation starts?
    
    <!-- I dont have specific numeric requirement, i will make judgement by how
    it feels and how it looks, you can create base set of benchmarks your self.
    -->
