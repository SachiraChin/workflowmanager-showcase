# Workflow Editor Library Evaluation (r2)

## Summary

This revision updates the evaluation plan based on operator feedback.

We are not locking into a single library yet. We start with React Flow as the
first PoC candidate, but final selection depends on PoC outcomes.

Two PoC tracks are now required:

1. Performance/nesting stress PoC.
2. Workflow-realism PoC based on `workflows/cc/steps/1_user_input`, rendering
   two modules in the best practical UX.

## Design Decisions

1. No final editor-library commitment is made in this revision.
2. PoCs are the decision gate; score tables guide priority but do not decide
   alone.
3. PoC execution order starts with React Flow.
4. Fallback priority (if React Flow is rejected):
   - X6
   - JointJS
   - Rete
5. `ui/editor` workspace scaffolding is approved to proceed.
6. Editor remains its own standalone web app workspace (`ui/editor`).
7. We still preserve shared-first reuse (`@wfm/shared`) and theme parity with
   current webui CSS variable model.

## Technical Specification

### Architecture Context (Verified)

- Existing UI workspaces are `shared` and `webui`.
- `@wfm/shared` exports broad reusable interaction/state/UI primitives.
- webui theme model uses Tailwind v4 + CSS variables + `light/dark` classes.

### Library Decision Process Update

The previous weighted matrix remains useful for prioritization, but the
operator requested PoC-first validation before any final selection.

Working shortlist and order:

1. React Flow (first PoC baseline)
2. X6 (first fallback)
3. JointJS (second fallback)
4. Rete (third fallback)

GoJS and yFiles remain known strong options, but licensing/procurement
friction makes them lower immediate priority for initial product iteration.

### PoC Track A: Performance/Nesting Stress

Purpose: validate deep nested structures and editor responsiveness.

Test dataset:

- 6-8 nested levels.
- 200-400 nodes.
- mixed intra-level and cross-level edges.

Must-test operations:

- create/move/delete at multiple depths,
- collapse/expand nested groups,
- pan/zoom during active edits,
- selection consistency,
- undo/redo behavior.

Acceptance style:

- No strict operator-provided numeric limits.
- Pass/fail by practical UX quality and stability.
- We still record baseline metrics to compare libraries.

Baseline metrics to capture (assistant-defined):

- frame stability during drag/pan,
- time to first interactive render,
- command latency for common edits,
- error rate across repeated nested operations.

### PoC Track B: Workflow-Realism (`1_user_input`)

Purpose: verify whether candidate libraries can model real module UX for an
actual workflow step, not only synthetic stress graphs.

Scope:

- Target: `workflows/cc/steps/1_user_input`.
- Implement a focused canvas/page rendering two modules in this step with best
  practical visual and interaction quality.
- Do not modify workflow files in that folder for PoC rendering.

Evaluation focus:

- module card readability and hierarchy clarity,
- connection clarity (ports/edges/labels),
- edit ergonomics for real module configurations,
- alignment with shared components and theme model.

### Workspace and App Strategy

- Proceed with `ui/editor` scaffolding now.
- During PoCs, add separate pages per PoC variant inside editor app routes.
- Keep renderer-specific details isolated to reduce switch cost.

Recommended technical boundaries:

- Editor domain types (nodes/edges/groups/commands) live in editor code.
- Renderer adapter layer maps domain types to each library.
- Shared UI comes from `@wfm/shared` where practical.

### Updated Risk Register

1. Deep nesting interaction behavior may still fail acceptance in first choice.
2. Workflow-realism PoC might reveal UX gaps not visible in stress tests.
3. Library switch cost can grow if renderer abstractions are skipped early.
4. Route-level PoC pages can drift in quality unless acceptance checks are
   consistent across candidates.

Mitigation:

- enforce same PoC checklists and capture sheets across candidates,
- keep renderer behind adapter interfaces,
- evaluate stress and realism PoCs before advancing full editor features.

## Database Schema

No database schema changes in this revision.

## API Contracts

No API contract changes in this revision.

## Questions for Review

1. Confirm PoC execution order as React Flow -> X6 -> JointJS -> Rete.
2. Confirm PoC page strategy inside editor app routes is acceptable for all
   candidates.
3. Confirm that assistant-defined baseline metrics are sufficient for
   side-by-side comparison despite qualitative final judgment.
