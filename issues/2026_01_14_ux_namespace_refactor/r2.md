# Issue: UX Namespace Refactor (`_ux`) - Revision 2

## Status: IMPLEMENTATION IN PROGRESS

### Completed

**WebUI:**
- [x] Created `webui/src/components/workflow/interactions/schema-interaction/ux-utils.ts`
  - `getUx(schema)` - extracts UX config from `_ux` object or `_ux.*` flat notation
  - Supports nested paths: `_ux.card.title` → `{ card: { title: value } }`
  - `hasUx(schema)` - checks if UX config exists
- [x] Updated `types.ts` with `UxConfig` interface and `_ux` support
- [x] Updated core renderers to accept/pass `ux` prop:
  - SchemaRenderer.tsx
  - ArraySchemaRenderer.tsx
  - ObjectSchemaRenderer.tsx
  - TableSchemaRenderer.tsx
  - ContentPanelSchemaRenderer.tsx
- [x] Updated layouts to use `ux` prop:
  - CardLayout.tsx
  - SectionLayout.tsx
  - DefaultLayout.tsx
- [x] Updated `useSelectable.ts` to accept `UxConfig`
- [x] Updated `renderers/TerminalRenderer.tsx` to accept `ux` prop
- [x] Deleted legacy files:
  - SchemaRenderer.old.tsx
  - SelectableItem.tsx
  - renderers/layouts/* (old layout system)
  - helpers/extractInnerData.ts
  - helpers/getRenderer.ts
  - helpers/index.ts
  - renderer-types.ts

**TUI:**
- [x] Created `tui/strategies/ux_utils.py`
  - `get_ux(schema)` - extracts UX config from `_ux` object or `_ux.*` flat notation
  - `get_ux_value(schema, key, default)` - convenience function for single property
  - `has_ux(schema)` - checks if UX config exists
  - Supports nested paths like WebUI
- [x] Updated `tui/strategies/mixins.py` to use `get_ux_value()`
- [x] Updated `tui/strategies/review_grouped.py` to use `get_ux_value()`

### Pending

- [ ] **Update workflow schemas to use `_ux` namespace** - Manual update of 36 display schema files

---

## Design Changes from r1

### No Backwards Compatibility

Per operator decision, **legacy root-level properties are NOT supported**. All UX properties must use the `_ux` namespace:

```json
// REQUIRED - one of these formats:
{ "_ux": { "display": true, "render_as": "card" } }
{ "_ux.display": true, "_ux.render_as": "card" }

// NO LONGER SUPPORTED:
{ "display": true, "render_as": "card" }
```

### Nested Path Support

The `_ux.*` flat notation now supports nested paths:

```json
{
  "_ux.display": true,
  "_ux.card.expanded": false,
  "_ux.card.title": "My Card"
}
```

Extracts to:
```json
{
  "display": true,
  "card": {
    "expanded": false,
    "title": "My Card"
  }
}
```

### Flat Notation Overrides Object Notation

When both are present, flat notation takes precedence:

```json
{
  "_ux": { "display": "hidden" },
  "_ux.display": "visible"
}
// Result: { "display": "visible" }
```

---

## Commits Made

1. `feat(schema-interaction): Add _ux namespace infrastructure for schema-driven UI`
   - Created ux-utils.ts, updated types.ts, core renderers, layouts
   - Deleted legacy files

2. `feat(ux-namespace): Add _ux namespace extraction for TUI and WebUI`
   - Created tui/strategies/ux_utils.py
   - Updated mixins.py, review_grouped.py
   - Updated webui ux-utils.ts to remove legacy support and add nested path support

---

## Next Steps

1. Manually update workflow display schemas to use `_ux` namespace (36 files)
2. Test WebUI and TUI with updated schemas
3. Mark issue as fixed

---

## Files Modified

### WebUI (New/Modified)
```
webui/src/components/workflow/interactions/schema-interaction/
├── ux-utils.ts (NEW)
├── types.ts (MODIFIED)
├── SchemaRenderer.tsx (MODIFIED)
├── ArraySchemaRenderer.tsx (MODIFIED)
├── ObjectSchemaRenderer.tsx (MODIFIED)
├── TableSchemaRenderer.tsx (MODIFIED)
├── ContentPanelSchemaRenderer.tsx (MODIFIED)
├── useSelectable.ts (MODIFIED)
├── index.ts (MODIFIED)
├── layouts/
│   ├── types.ts (MODIFIED)
│   ├── CardLayout.tsx (MODIFIED)
│   ├── SectionLayout.tsx (MODIFIED)
│   └── DefaultLayout.tsx (MODIFIED)
└── renderers/
    ├── index.ts (MODIFIED)
    └── TerminalRenderer.tsx (MODIFIED)
```

### WebUI (Deleted)
```
webui/src/components/workflow/interactions/schema-interaction/
├── SchemaRenderer.old.tsx (DELETED)
├── SelectableItem.tsx (DELETED)
├── helpers/ (DELETED - entire folder)
├── renderers/layouts/ (DELETED - entire folder)
└── renderers/renderer-types.ts (DELETED)
```

### TUI (New/Modified)
```
tui/strategies/
├── ux_utils.py (NEW)
├── mixins.py (MODIFIED)
└── review_grouped.py (MODIFIED)
```
