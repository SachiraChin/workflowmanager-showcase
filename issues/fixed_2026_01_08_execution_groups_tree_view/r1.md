# Issue: Execution Groups Not Displayed Correctly in Workflow State Tree

## Summary

When a workflow contains `pipeline.execution_groups` modules, the WebUI Workflow State tree view cannot display grouped modules correctly. Modules from execution groups should be shown nested under their parent group with x.y numbering.

## Architecture Reference

**Document**: `architecture/2026_01_06_aesthetic_selection_ux/r5.md`

**Lines 876-913** show expected flattened structure with `_group_origin` metadata:
```json
{
  "module_id": "user.form",
  "name": "aesthetic_form",
  "_group_origin": {
    "group_name": "aesthetic_selection_pipeline",
    "path_name": "webui_path"
  }
}
```

## Expected Behavior

1. Tree shows execution_groups module as a parent node
2. Child modules (from selected path) are nested under the group
3. Numbering uses x.y format (x = group index, y = module index within group)
4. Clicking gear on grouped module shows its configuration
5. Clicking gear on group shows group configuration (from raw workflow)

## Actual Behavior

1. Grouped modules appear as flat list (no nesting)
2. No indication which modules belong to which group
3. Clicking gear on grouped module shows "Module configuration not found"

## Dependencies

**Blocked by**: `issues/2026_01_08_version_fields_cleanup`

The `/definition` endpoint must return the flattened workflow (with `_group_origin` metadata) before this issue can be fully resolved. Currently it returns the raw workflow.

## Root Cause Analysis

1. `/definition` returns raw workflow (contains `pipeline.execution_groups` modules)
2. State/v2 returns outputs from flattened execution (modules have `_group_origin`)
3. `getModuleConfig()` looks up from raw workflow → fails for grouped modules
4. Tree component has no logic to detect/display group relationships

## Proposed Solution

### After Version Fields Issue is Resolved

Once `/definition` returns both raw and flattened workflows:

1. **WorkflowStateContext**: Store both definitions
   ```typescript
   interface WorkflowDefinitions {
     definition: WorkflowDefinition;      // flattened (for execution)
     rawDefinition?: WorkflowDefinition;  // raw (for group structure)
     selectedPaths?: Record<string, string>;
   }
   ```

2. **getModuleConfig**: Enhanced lookup
   ```typescript
   const getModuleConfig = (stepId: string, moduleName: string) => {
     // Look up from flattened definition (has grouped modules)
     return lookupInDefinition(definitions.definition, stepId, moduleName);
   };

   const getGroupConfig = (stepId: string, groupName: string) => {
     // Look up from raw definition (has execution_groups)
     return lookupInDefinition(definitions.rawDefinition, stepId, groupName);
   };
   ```

3. **StateTreeView**: Build grouped tree structure
   - Detect modules with `_group_origin` metadata
   - Group them by `_group_origin.group_name`
   - Render as nested tree under a virtual group node
   - Use x.y numbering based on `_group_origin.module_index`

### Tree Structure Example

Before (flat):
```
steps
└── user_input
    ├── 1. aesthetic_form
    ├── 2. format_aesthetics
    └── 3. use_aesthetics
```

After (grouped):
```
steps
└── user_input
    ├── 1. aesthetic_selection_pipeline [group]
    │   ├── 1.1 aesthetic_form
    │   └── 1.2 format_aesthetics
    └── 2. use_aesthetics
```

## Files Affected

- `webui/src/contexts/WorkflowStateContext.tsx` - Handle both definitions
- `webui/src/lib/api.ts` - Update response type
- `webui/src/lib/types.ts` - Add GroupOrigin type
- `webui/src/components/workflow/state/StateTreeView.tsx` - Build grouped tree

## Priority

**Medium**

Justification:
- Improves UX for workflows with execution groups
- Blocked by higher-priority version fields issue
- Workaround exists (view raw workflow JSON directly)
