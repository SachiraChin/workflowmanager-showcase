# Issue: Remove `prompt` and `description` Fields - Complete Implementation

## Server and WebUI Changes

See **r3.md** for detailed server-side and WebUI implementation plans.

## TUI Implementation

### Current Usage Analysis

| Strategy | title | prompt | description |
|----------|-------|--------|-------------|
| `text_input.py` | - | Line 17-19: `f"{request.prompt} [{default}]: "` | - |
| `file_input.py` | Line 88-89: Displays title | Line 101: `request.prompt or "Enter file path"` | Line 90-91: Displays description |
| `select_structured.py` | Line 50: `request.title or request.prompt` | Fallback only | - |
| `review_grouped.py` | Line 20: `request.title or "Review..."` | - | - |
| `resume_choice.py` | Uses hardcoded text | - | - |
| `retry_options.py` | Uses hardcoded text | - | - |
| `file_download.py` | Uses hardcoded text | - | - |

### TUI Strategy Changes

#### 1. `tui/strategies/text_input.py`

```python
# Before (lines 15-19)
# Build prompt
if request.default_value:
    full_prompt = f"{request.prompt} [{request.default_value}]: "
else:
    full_prompt = f"{request.prompt}: "

# After
# Build prompt - use title instead of prompt
if request.default_value:
    full_prompt = f"{request.title} [{request.default_value}]: "
else:
    full_prompt = f"{request.title}: "
```

#### 2. `tui/strategies/file_input.py`

```python
# Before (lines 86-92)
# Display prompt
self._log("")
if request.title:
    self._log(f"{request.title}")
if request.description:
    self._log(f"{Colors.DIM}{request.description}{Colors.RESET}")
self._log("")

# After - title only, extensions from display_data
self._log("")
if request.title:
    self._log(f"{request.title}")
extensions = request.display_data.get('extensions', []) if request.display_data else []
if extensions:
    ext_str = ", ".join(extensions)
    self._log(f"{Colors.DIM}Allowed: {ext_str}{Colors.RESET}")
self._log("")
```

```python
# Before (line 101)
prompt_text = request.prompt or "Enter file path"

# After - use title
prompt_text = request.title or "Enter file path"
```

#### 3. `tui/strategies/select_structured.py`

```python
# Before (line 50)
self._log(request.title or request.prompt or "Make a selection")

# After - title only
self._log(request.title or "Make a selection")
```

#### 4. `tui/strategies/review_grouped.py`

No changes needed - already only uses `request.title`.

#### 5. `tui/strategies/resume_choice.py`

No changes needed - uses hardcoded text.

#### 6. `tui/strategies/retry_options.py`

No changes needed - uses hardcoded text.

#### 7. `tui/strategies/file_download.py`

No changes needed - uses hardcoded text.

### TUI Files to Modify

| File | Change |
|------|--------|
| `tui/strategies/text_input.py` | Replace `request.prompt` with `request.title` |
| `tui/strategies/file_input.py` | Replace `request.prompt` with `request.title`, read extensions from `display_data` |
| `tui/strategies/select_structured.py` | Remove `request.prompt` fallback, use `request.title` only |

### Additional TUI Considerations

#### workflow_runner.py Conversion

Check if `workflow_runner.py` converts API responses to engine `InteractionRequest`. Line 873 shows:
```python
prompt=data.get("prompt", ""),
```

This needs to be removed after the contract changes, since `prompt` field won't exist.

#### Contracts Import

All TUI strategies import from `contracts`:
```python
from contracts import InteractionRequest, InteractionResponse
```

After removing `prompt` and `description` from `contracts/interactions.py`, the TUI code will automatically see the updated contract. No import changes needed.

## Complete Files to Modify (All Modules)

### Contracts
| File | Change |
|------|--------|
| `contracts/interactions.py` | Remove `prompt`, `description` fields |

### Server
| File | Change |
|------|--------|
| `server/api/models.py` | Remove `prompt`, `description` from API model |
| `server/modules/user/text_input.py` | Use `title=prompt` |
| `server/modules/user/select.py` | Remove `prompt=`, keep `title=` |
| `server/modules/user/form.py` | Remove `prompt=`, keep `title=` |
| `server/modules/user/file_input.py` | Use `title=prompt`, move extensions to `display_data` |
| `server/modules/user/pause.py` | Use `default_value` for content, add `multiline=True` |
| `server/modules/io/client_write.py` | Use `title=` with specific message |

### WebUI
| File | Change |
|------|--------|
| `webui/src/lib/types.ts` | Remove `prompt`, `description` |
| `webui/src/components/workflow/interactions/InteractionHost.tsx` | Remove `prompt` rendering |
| `webui/src/components/workflow/interactions/file-input/FileInputDropzone.tsx` | Read extensions from `display_data` |

### TUI
| File | Change |
|------|--------|
| `tui/strategies/text_input.py` | Replace `request.prompt` → `request.title` |
| `tui/strategies/file_input.py` | Replace `request.prompt` → `request.title`, read extensions from `display_data` |
| `tui/strategies/select_structured.py` | Remove `request.prompt` fallback |
| `tui/workflow_runner.py` | Remove `prompt=` from dict conversion (if applicable) |

## Plan of Action (POA)

### Phase 1: Contracts (Foundation)

- [ ] **1.1** `contracts/interactions.py` - Remove `prompt` and `description` fields from `InteractionRequest`

### Phase 2: Server Modules (Producers)

- [ ] **2.1** `server/modules/user/text_input.py` - Change `prompt=prompt` to `title=prompt`
- [ ] **2.2** `server/modules/user/select.py` - Remove `prompt=prompt`, keep `title=prompt`
- [ ] **2.3** `server/modules/user/form.py` - Remove `prompt=prompt`, keep `title=prompt`
- [ ] **2.4** `server/modules/user/file_input.py` - Change to `title=prompt`, add `display_data={"extensions": extensions}`
- [ ] **2.5** `server/modules/user/pause.py` - Set `title="Preview"`, use `default_value=full_message`, add `multiline=True`
- [ ] **2.6** `server/modules/io/client_write.py` - Change to `title=f"Writing {filename} to project folder"`

### Phase 3: Server API Models

- [ ] **3.1** `server/api/models.py` - Remove `prompt` and `description` from `ApiInteractionRequest`

### Phase 4: WebUI (Consumer)

- [ ] **4.1** `webui/src/lib/types.ts` - Remove `prompt` and `description` from `InteractionRequest` interface
- [ ] **4.2** `webui/src/components/workflow/interactions/InteractionHost.tsx` - Remove `prompt` rendering from header
- [ ] **4.3** `webui/src/components/workflow/interactions/file-input/FileInputDropzone.tsx` - Read extensions from `display_data` instead of `description`

### Phase 5: TUI (Consumer)

- [ ] **5.1** `tui/strategies/text_input.py` - Replace `request.prompt` with `request.title`
- [ ] **5.2** `tui/strategies/file_input.py` - Replace `request.prompt` with `request.title`, read extensions from `display_data`
- [ ] **5.3** `tui/strategies/select_structured.py` - Remove `request.prompt` fallback

### Phase 6: Cleanup & Testing

- [ ] **6.1** Search for any remaining references to `.prompt` or `.description` on InteractionRequest
- [ ] **6.2** Run server to verify no import/attribute errors
- [ ] **6.3** Test WebUI with a workflow run
- [ ] **6.4** Test TUI with a workflow run
- [ ] **6.5** Verify pause module displays long content correctly

## Testing Checklist

- [ ] All select interactions show correct title (WebUI + TUI)
- [ ] Form input shows correct title (WebUI + TUI)
- [ ] Text input shows correct title (WebUI + TUI)
- [ ] File input shows correct title and extensions work (WebUI + TUI)
- [ ] File download shows specific filename in title (WebUI + TUI)
- [ ] Pause module displays long content in scrollable textarea (WebUI + TUI)
- [ ] No runtime errors from missing `prompt`/`description` attributes
